notifications:
  email: false
language: c
compiler: gcc
sudo: false
env:
  global:
  - VERSION=15.05.1
  matrix:
  - ARCH=ar71xx
  - ARCH=kirkwood
install:
- mkdir sdk && cd sdk
- SDK_NAME=$( curl https://downloads.openwrt.org/chaos_calmer/${VERSION}/${ARCH}/generic/md5sums | grep -Po '(?<=\s\*)OpenWrt-SDK.*$' )
- curl https://downloads.openwrt.org/chaos_calmer/15.05/${ARCH}/generic/${SDK_NAME} | tar -xj --strip-components=1
- ln -s $TRAVIS_BUILD_DIR/eiskaltdcpp $TRAVIS_BUILD_DIR/sdk/package/eiskaltdcpp
script:
- cd $TRAVIS_BUILD_DIR/sdk
- make package/eiskaltdcpp/download V=99
- make package/eiskaltdcpp/prepare V=99
# preempt failing download in cmake
- cd $TRAVIS_BUILD_DIR/sdk/build_dir/target-*/eiskaltdcpp-*/
- curl -LO http://sf.net/projects/eiskaltdcpp/files/Other/boost.tar.gz
- cd $TRAVIS_BUILD_DIR/sdk
- make package/eiskaltdcpp/compile V=99
deploy:
  provider: releases
  api_key:
    secure: gclYV0a3q36jUZmfQNCLGtrAf+ZbhdYc1W7s0bNouBeMdozp2AsJDiyqOQYX3rE2I+bOJXrxvsamqaTrNuzFk3bL00efuBrq/uGSwCxrn4/wl+Yt5S5iS7I6LCd3PEdzZLkG3Nbp6PKqng/ILO2XA3JnYkJ/jhIRJBLrpu0AWt0=
  skip_cleanup: true
  file_glob: true
  file: "$TRAVIS_BUILD_DIR/sdk/bin/*/packages/eiskaltdcpp_*.ipk"
  on:
    tags: true
    all_branches: true
