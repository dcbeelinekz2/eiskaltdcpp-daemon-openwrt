notifications:
  email: false
language: c
compiler: gcc
sudo: false
env:
  global:
  - VERSION=15.05.1
  matrix:
  - ARCH=adm5120
  - ARCH=adm8668
  - ARCH=ar7
  - ARCH=ar71xx
  - ARCH=at91
  - ARCH=ath25
  - ARCH=au1000
  - ARCH=bcm53xx
  - ARCH=brcm2708
  - ARCH=brcm47xx
  - ARCH=brcm63xx
  - ARCH=cns3xxx
  - ARCH=cns3xxx
  - ARCH=imx6
  - ARCH=ixp4xx
  - ARCH=kirkwood
  - ARCH=lantiq
  - ARCH=malta
  - ARCH=mcs814x
  - ARCH=mpc85xx
  - ARCH=mvebu
  - ARCH=mxs
  - ARCH=netlogic
  - ARCH=octeon
  - ARCH=omap
  - ARCH=oxnas
  - ARCH=ppc44x
  - ARCH=ramips
  - ARCH=rb532
  - ARCH=realview
  - ARCH=sunxi
  - ARCH=x86
  - ARCH=xburst
install:
- mkdir sdk && cd sdk
- SDK_NAME=$( curl https://downloads.openwrt.org/chaos_calmer/${VERSION}/${ARCH}/generic/md5sums | grep -Po '(?<=\s\*)OpenWrt-SDK.*$' )
- curl https://downloads.openwrt.org/chaos_calmer/${VERSION}/${ARCH}/generic/${SDK_NAME} | tar -xj --strip-components=1
- ln -s $TRAVIS_BUILD_DIR/eiskaltdcpp $TRAVIS_BUILD_DIR/sdk/package/eiskaltdcpp
script:
- cd $TRAVIS_BUILD_DIR/sdk
- make package/eiskaltdcpp/download V=99
- make package/eiskaltdcpp/prepare V=99
# preempt failing download in cmake
- cd $TRAVIS_BUILD_DIR/sdk/build_dir/target-*/eiskaltdcpp-*/
- curl -LO http://sf.net/projects/eiskaltdcpp/files/Other/boost.tar.gz
- cd $TRAVIS_BUILD_DIR/sdk
- make package/eiskaltdcpp/compile V=99
deploy:
  provider: releases
  api_key:
    secure: gclYV0a3q36jUZmfQNCLGtrAf+ZbhdYc1W7s0bNouBeMdozp2AsJDiyqOQYX3rE2I+bOJXrxvsamqaTrNuzFk3bL00efuBrq/uGSwCxrn4/wl+Yt5S5iS7I6LCd3PEdzZLkG3Nbp6PKqng/ILO2XA3JnYkJ/jhIRJBLrpu0AWt0=
  skip_cleanup: true
  file_glob: true
  file: "$TRAVIS_BUILD_DIR/sdk/bin/*/packages/eiskaltdcpp_*.ipk"
  on:
    tags: true
    all_branches: true
